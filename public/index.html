<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VisualCortex</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="cytoscape.js"></script>
    <script src="https://cdn.rawgit.com/maxkfranz/weaver/v1.2.0/dist/weaver.min.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-spread/1.3.1/cytoscape-spread.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cose-bilkent/1.6.5/cytoscape-cose-bilkent.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cola/1.6.0/cola.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cola/1.6.0/cytoscape-cola.js"></script>
    <script src="https://cdn.rawgit.com/cpettitt/dagre/v0.7.4/dist/dagre.min.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-dagre/1.5.0/cytoscape-dagre.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js"></script>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.css"
          rel="stylesheet" type="text/css"/>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-qtip/2.7.0/cytoscape-qtip.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<style>
    #cy {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
    }
</style>
<body>
<div id="cy"></div>
<script>
    // google.charts.load('current', {'packages': ['corechart']})
    $(document).ready(function () {
        $.getJSON("graph.json", function (data) {
            console.log(data);
            draw_graph(data);
        })

        //google.charts.setOnLoadCallback(
//            function () {
//            }
//        );
    });

    function extract_cy_elements(json_data) {
        console.log("extracting cy elements...");
        console.log(json_data.nodes)
        var nodes = [];
        for (var node_idx in json_data.nodes) {
            node_data = json_data.nodes[node_idx];
            node_data.color = '#11479e';
            if (node_data.is_missing === true) {
                node_data.color = 'grey';
            }
            nodes.push({data: node_data})
        }
        var edges = [];
        for (var edge_idx in json_data.edges) {
            edge_data = json_data.edges[edge_idx];
            edge_data.color = '#9dbaea';
            if (edge_data.is_missing) {
                edge_data.color = 'grey';
            }
            edges.push({data: edge_data})
        }
        return {
            nodes: nodes,
            edges: edges
        };
    }

    function draw_graph(json_data) {
        console.log("drawing graph...");
        var elements = extract_cy_elements(json_data);
        console.log(elements);
        var cy = cytoscape({
            container: document.getElementById('cy'),
            boxSelectionEnabled: false,
            autounselectify: false,
            maxZoom: 2,
            minZoom: 0.2,
            style: [
                {
                    selector: 'node',
                    style: {
                        'shape': 'rectangle',
                        'label': 'data(repr)',
                        'text-opacity': 1,
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'background-color': 'white',
                        'border-color': 'data(color)',
                        'border-width': '5px',
                        'width': 'label',
                        'height': '50px',
                        'padding': '2px'
                    }
                }, {
                    selector: 'edge',
                    style: {
                        'curve-style': 'bezier',
                        'width': 4,
                        'target-arrow-shape': 'triangle',
                        'line-color': 'data(color)',
                        'target-arrow-color': 'data(color)'
                    }
                }],
            elements: elements,
            layout: {
                name: 'cose-bilkent',
                padding: 20,
                nodeDimensionsIncludeLabels: true,
                directed: true,
                nodeRepulsion: 100000
            }
        });

        // you can use qtip's regular options
        // see http://qtip2.com/
        for (var node_idx in elements.nodes) {
            node = json_data.nodes[node_idx];

            cy.$('#'.concat(node.id)).qtip({
                content: 'Coverage: '.concat(node.coverage.toString()),
                position: {
                    my: 'top left',
                    at: 'bottom left'
                },
                style: {
                    classes: 'qtip-bootstrap',
                    tip: {
                        width: 16,
                        height: 8
                    }
                }
            });

            // drawCoverage(node.id, node.repr.split(''), node.coverage)
        }

    }

    /*
     function zip(arrays) {
     return arrays[0].map(function (_, i) {
     return arrays.map(function (array) {
     return array[i]
     })
     });
     }
     function drawCoverage(id, labels, coverage) {
     var data = google.visualization.arrayToDataTable(zip([labels,coverage]));

     var options = {
     title: 'Coverage',
     vAxis: {title: 'Coverage'},
     isStacked: true
     };

     console.log(id)
     var chart = new google.visualization.SteppedAreaChart($('#'.concat(id)));

     chart.draw(data, options);
     }
     */


</script>

</body>
</html>
